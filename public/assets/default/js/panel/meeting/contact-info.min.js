(function($) {
    'use strict';

    $('body').on('click', '.contact-info', function(event) {
        event.preventDefault();

        var element = $(this),
            userId = element.attr('data-user-id'),
            userType = element.attr('data-user-type'),
            itemId = element.attr('data-item-id');

        loadingSwl();

        var requestData = {
            user_id: userId,
            user_type: userType,
            item_id: itemId
        };

        $.post('/panel/users/contact-info', requestData, function(response) {
            if (response && response.code === 200) {
                var lang = userType === 'instructor' ? instructor_contact_information_lang : student_contact_information_lang;

                var modalContent = `
                    <div class="contact-info-modal">
                        <h2 class="section-title after-line">${lang}</h2>
                        <div class="mt-25 d-flex flex-column align-items-center justify-content-center">
                            <div class="contact-avatar">
                                <img src="${response.avatar}" class="img-cover" alt="">
                            </div>
                            <div class="mt-15 w-75 text-center">
                                <h3 class="font-16 font-weight-bold text-dark-blue">${response.name}</h3>
                                <div class="d-flex align-items-center justify-content-between mt-15">
                                    <span class="text-left mr-15 flex-grow-1 email-link">${email_lang} :</span>
                                    <a class="text-right email-link" href="#" data-email="${response.email}">${response.email}</a>
                                </div>
                                <div class="d-flex align-items-center justify-content-between mt-15">
                                    <span class="text-left mr-15 flex-grow-1 phone-link">${phone_lang} :</span>
                                    <a class="text-right phone-link" href="#" data-phone="${response.phone}">${response.phone}</a>
                                </div>
                                ${response.location && response.location !== 'null' ? `
                                    <div class="d-flex align-items-center justify-content-between mt-15">
                                        <span class="text-left mr-15 flex-grow-1">${location_lang} :</span>
                                        <span class="text-right">${response.location}</span>
                                    </div>` : ''}
                            </div>
                        </div>
                        ${response.description && response.description !== 'null' ? `
                            <div class="mt-25 rounded-sm border p-10 text-gray font-16">${response.description}</div>
                        ` : ''}
                        <div class="mt-30 d-flex align-items-center justify-content-end">
                            <button type="button" class="btn btn-sm btn-danger ml-10 close-swl">${close_lang}</button>
                        </div>
                    </div>`;

                Swal.fire({
                    html: modalContent,
                    showCancelButton: false,
                    showConfirmButton: false,
                    customClass: { content: 'p-0 text-left' },
                    width: '40rem'
                });

                // Handle email link click
                if (response.email && response.email !== 'null') {
                    $('.email-link').on('click', function(event) {
                        event.preventDefault();
                        var email = $(this).data('email');
                        window.open('mailto:' + email, '_blank');
                    });
                }

                // Handle phone link click
                if (response.phone && response.phone !== 'null') {
                    $('.phone-link').on('click', function(event) {
                        event.preventDefault();
                        var phoneNumber = $(this).data('phone');

                        // Memeriksa apakah nomor telepon diawali dengan "08"
                        if (phoneNumber.startsWith('08')) {
                            // Jika ya, tambahkan kode negara (62 untuk Indonesia) sebelum nomor telepon
                            phoneNumber = '62' + phoneNumber.substring(1);
                        }

                        // Membuka link WhatsApp dengan nomor telepon yang sudah diformat
                        window.open('https://api.whatsapp.com/send?phone=' + phoneNumber, '_blank');
                    });
                }
            }
        });
    });

})(jQuery);
